---
name: packet-run-server
mmdebstrap:
  customize-hooks:
  - |
    # Load application code
    cp -R /opt/packet-run/server $1/opt/packet-run/server/

    # Install server dependencies and build
    cd $1/opt/packet-run/server/
    npm install
    npm run build

    # Create packet-run-server service from template
    cat ./packet-run/packet-run-server.service.tpl | sed \
      -e "s|<SERVICE_USER>|${IGconf_device_user1}|g" \
      > $1/etc/systemd/system/packet-run-server.service

    # Enable service
    $BDEBSTRAP_HOOKS/enable-units "$1" packet-run-server

  packages: